# 写在最后

- 本文章的名字虽然为"写在最后"，但并不是SSO-CAS的学习就仅限于此，而是就目前的情况做部分的总结
- 对于目前(2020-06-25)所需要总结的是：

  - 在搭建SSO-CAS时应当注意：

    1. TGT票据的缓存（什么是TGT请看之前的文章或者百度谷歌）
    2. TGT票据的刷新
  - 【问题】 **为什么需要缓存TGT**

    - 对于TGT票据的缓存，是CAS的核心，因为CAS-Server会根据TGT去签发ST(Service Ticket),而且TGT是有一个有效期的，因为不可能让用户处于一直登录的状态。
  - 【问题】 **为什么需要刷新TGT**

    - 对于TGT票据的刷新，上面说到了，不可能让用户一直处于登录的状态，当用户在一定的时间内没有失效，则应该考虑让用户的登录失效，这样才能保证系统的安全。这样实现是基于 **CAS-Server会根据TGT票据生成ST，从而让客户端实现登录** 的原理的，当TGT不存在或者失效了，自然就需要重新登录了。
- 目前的情况：

  1. CAS-Server默认的TGT缓存和刷新策略

     - CAS-Server会有定时任务去检测TGT是否失效，如果失效了，则会清理掉。
     - CAS-Server将TGT缓存在内存中
  2. 基于CAS-Server默认的TGT缓存和刷新策略，存在的问题有

     - 当用户登录之后，一直在操作，时长不限。但是在操作的时候，TGT失效了，并且被清理了，那么该用户在CAS-Server中就不是处于登录状态了。这就会造成一个问题，在App1中登录了，并一直在APP1中操作。一段时间后，TGT失效了，即在CAS-Server中是处于未登录状态，此时去访问App2，那么就需要重新登录了。按正常的理解，登录了，一直处于活动状态，为什么还会需要重新登录？？？
- 目前的问题(由“目前的情况”第二点引出)

  - 在App1中登录了，并一直在APP1中操作。一段时间后，TGT失效了，即在CAS-Server中是处于未登录状态，此时去访问App2，那么就需要重新登录了。按正常的理解，登录了，一直处于活动状态，为什么还会需要重新登录？？？

    - 因此，需要一种TGT票据的刷新策略
    - 解决方案：

      - TGT的缓存使用Redis来实现
      - 但是，如何刷新TGT，即TGT刷新策略以及清理策略是什么？如何实现？

        - **Step1.** CAS-Server新开一个接口restUpdateTGT,类似于标准接口/serviceValidate,该接口的功能就是更新TGT的更新时间
        - **Step2.** 由客户端前段框架(img.src=xxxx.xx/restUpdateTGT?tgtid=yyy)或者后端监控用户行为，并定时调用接口restUpdateTGT,更新TGT的更新时间
        - 因此，TGT的清理策略为：

          - 将当前时间与TGT更新时间做减法，当大于TGT有效时长，则清理掉该TGT