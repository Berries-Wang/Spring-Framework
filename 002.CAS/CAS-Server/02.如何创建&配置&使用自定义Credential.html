<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 9.7.4 (472469)"/><meta name="author" content="1849553578@qq.com"/><meta name="created" content="2020-06-22 16:23:47 +0000"/><meta name="source" content="desktop.win"/><meta name="source-application" content="yinxiang.win32"/><meta name="updated" content="2020-06-25 00:53:29 +0000"/><meta name="content-class" content="yinxiang.markdown"/><title>02.如何创建&amp;配置&amp;使用自定义Credential</title></head><body><div style="font-size: 14px; margin: 0; padding: 0; width: 100%;"><h1 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 41px; border-bottom: 3px double #999; color: #000; margin-top: 14px;">02.如何创建&amp;配置&amp;使用自定义Credential</h1>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">什么是Credential</h2>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">Credential：证书，凭证</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">在CAS-Server中，Credential表示的是用户登录的实体，即用户输入的用户名，密码等等。这个CAS-Server会传递给AuthenticationHandler，由AuthenticationHandler去处理，判断用户输入的数据是否正确，是否允许用户登录。</li>
</ul>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">使用步骤</h2>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">1. 背景描述</h3>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">
<p style="line-height: 160%; box-sizing: content-box; color: #333; margin: 0;">一般使用的Credential是RememberMeUsernamePasswordCredential，且是在applications中配置了：</p>
<ol style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal; margin-top: 0; margin-bottom: 0;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">是否记住登录用户<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">cas.ticket.tgt.rememberMe.enabled=true</span>
</code></pre>
</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">Ticket 过期时间<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">  <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">## Ticket过期时间</span>
  <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">cas.ticket.tgt.rememberMe.timeToKillInSeconds=7200</span>
  <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">cas.ticket.tgt.timeout.maxTimeToLiveInSeconds=7200</span>
</code></pre>
</li>
</ol>
</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">
<p style="line-height: 160%; box-sizing: content-box; color: #333; margin: 0;">配置了这些之后，看下源代码。</p>
<ol style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal; margin-top: 0; margin-bottom: 0;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">代码所在的类：org.apereo.cas.web.flow.configurer.DefaultLoginWebflowConfigurer</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">代码片段：<img src="02.%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA&amp;%E9%85%8D%E7%BD%AE&amp;%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89Credential.resources/9E06BDF8-CAE1-4A50-AA52-004D8F5CA5AA.png" height="1058" width="1920"/>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333; margin-top: 0; margin-bottom: 0;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">如上代码所述，当配置了Remember Me之后，会创建RememberMeUsernamePasswordCredential类型的Credential，这是个契机，可以利用这个契机来实现自己的Credential.</li>
</ul>
</li>
</ol>
</li>
</ul>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">2. 自定义实现Credential</h3>
<h4 style="line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;">01.创建自己的Credential，继承RememberMeUsernamePasswordCredential</h4>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><img src="02.%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA&amp;%E9%85%8D%E7%BD%AE&amp;%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89Credential.resources/C27B8660-F3AD-4368-9C43-3DC66794299C.png" height="1058" width="1920"/></li>
</ul>
<h4 style="line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;">02. 创建自定义配置的WebflowConfigurer，继承DefaultLoginWebflowConfigurer</h4>
<h5 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 16px; color: #333;">02-1.目的</h5>
<ol style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;">
<li style="line-height: 160%; box-sizing: content-box;">这样做的目的就是能够在配置了Remember Me之后，能够使用我们自定义的Credential。</li>
</ol>
<h5 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 16px; color: #333;">02-2.重写方法（createRememberMeAuthnWebflowConfig）</h5>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><img src="02.%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA&amp;%E9%85%8D%E7%BD%AE&amp;%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89Credential.resources/4702B5EA-085A-4254-85A1-661FDC659BFC.png" height="1058" width="1920"/></li>
</ul>
<h5 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 16px; color: #333;">02-3.如何使用自定义配置WebflowConfigurer</h5>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><img src="02.%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA&amp;%E9%85%8D%E7%BD%AE&amp;%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89Credential.resources/6B53F784-F33E-496F-9EFE-41116D582CF2.png" height="1058" width="1920"/></li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">注意，这个方法在cn.bosswang.Weisaas.config.CasAuthenticationConfiguration中写的，这个类在文件spring.factories中已经配置，会作为一个启动配置被加载。</li>
</ul>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">3. 如何将属性映射到Credential中的字段上</h3>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">既然自定义了Credential，肯定会新增一些字段，那么前端页面中的表单上的字段如何映射到对应的Credential的字段上呢？
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333; margin-top: 0; margin-bottom: 0;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">文件：casLoginView.html（单点登录页面）</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">如何对应：<img src="02.%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA&amp;%E9%85%8D%E7%BD%AE&amp;%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89Credential.resources/8A4FDCBD-7D3A-4668-B22B-9F74BA7E9EFC.png" height="1058" width="1920"/></li>
</ul>
</li>
</ul>
</div><center style="display:none !important;visibility:collapse !important;height:0 !important;white-space:nowrap;width:100%;overflow:hidden">%23%2002.%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA%26%E9%85%8D%E7%BD%AE%26%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89Credential%0A%23%23%20%E4%BB%80%E4%B9%88%E6%98%AFCredential%0A%2B%20Credential%EF%BC%9A%E8%AF%81%E4%B9%A6%EF%BC%8C%E5%87%AD%E8%AF%81%0A%2B%20%E5%9C%A8CAS-Server%E4%B8%AD%EF%BC%8CCredential%E8%A1%A8%E7%A4%BA%E7%9A%84%E6%98%AF%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E7%9A%84%E5%AE%9E%E4%BD%93%EF%BC%8C%E5%8D%B3%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%E7%9A%84%E7%94%A8%E6%88%B7%E5%90%8D%EF%BC%8C%E5%AF%86%E7%A0%81%E7%AD%89%E7%AD%89%E3%80%82%E8%BF%99%E4%B8%AACAS-Server%E4%BC%9A%E4%BC%A0%E9%80%92%E7%BB%99AuthenticationHandler%EF%BC%8C%E7%94%B1AuthenticationHandler%E5%8E%BB%E5%A4%84%E7%90%86%EF%BC%8C%E5%88%A4%E6%96%AD%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%E7%9A%84%E6%95%B0%E6%8D%AE%E6%98%AF%E5%90%A6%E6%AD%A3%E7%A1%AE%EF%BC%8C%E6%98%AF%E5%90%A6%E5%85%81%E8%AE%B8%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E3%80%82%0A%23%23%20%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4%0A%23%23%23%201.%20%E8%83%8C%E6%99%AF%E6%8F%8F%E8%BF%B0%0A%2B%20%E4%B8%80%E8%88%AC%E4%BD%BF%E7%94%A8%E7%9A%84Credential%E6%98%AFRememberMeUsernamePasswordCredential%EF%BC%8C%E4%B8%94%E6%98%AF%E5%9C%A8applications%E4%B8%AD%E9%85%8D%E7%BD%AE%E4%BA%86%EF%BC%9A%0A%20%20%20%201.%20%E6%98%AF%E5%90%A6%E8%AE%B0%E4%BD%8F%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%0A%20%20%20%20%20%20%20%20%60%60%60yml%0A%20%20%20%20%20%20%20%20%20%20%20%20cas.ticket.tgt.rememberMe.enabled%3Dtrue%0A%20%20%20%20%20%20%20%20%60%60%60%0A%20%20%20%202.%20Ticket%20%E8%BF%87%E6%9C%9F%E6%97%B6%E9%97%B4%0A%20%20%20%20%20%20%20%20%20%60%60%60yml%0A%20%20%20%20%20%20%20%20%20%20%20%23%23%20Ticket%E8%BF%87%E6%9C%9F%E6%97%B6%E9%97%B4%0A%20%20%20%20%20%20%20%20%20%20%20cas.ticket.tgt.rememberMe.timeToKillInSeconds%3D7200%0A%20%20%20%20%20%20%20%20%20%20%20cas.ticket.tgt.timeout.maxTimeToLiveInSeconds%3D7200%0A%20%20%20%20%20%20%20%20%60%60%60%0A%20%20%20%0A%2B%20%E9%85%8D%E7%BD%AE%E4%BA%86%E8%BF%99%E4%BA%9B%E4%B9%8B%E5%90%8E%EF%BC%8C%E7%9C%8B%E4%B8%8B%E6%BA%90%E4%BB%A3%E7%A0%81%E3%80%82%0A%20%201.%20%E4%BB%A3%E7%A0%81%E6%89%80%E5%9C%A8%E7%9A%84%E7%B1%BB%EF%BC%9Aorg.apereo.cas.web.flow.configurer.DefaultLoginWebflowConfigurer%0A%20%202.%20%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5%EF%BC%9A!%5Ba2d0705ee621c148473ca48bbf48ce78.png%5D(en-resource%3A%2F%2Fdatabase%2F3219%3A0)%0A%20%20%20%20%20%20%20-%20%E5%A6%82%E4%B8%8A%E4%BB%A3%E7%A0%81%E6%89%80%E8%BF%B0%EF%BC%8C%E5%BD%93%E9%85%8D%E7%BD%AE%E4%BA%86Remember%20Me%E4%B9%8B%E5%90%8E%EF%BC%8C%E4%BC%9A%E5%88%9B%E5%BB%BARememberMeUsernamePasswordCredential%E7%B1%BB%E5%9E%8B%E7%9A%84Credential%EF%BC%8C%E8%BF%99%E6%98%AF%E4%B8%AA%E5%A5%91%E6%9C%BA%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%88%A9%E7%94%A8%E8%BF%99%E4%B8%AA%E5%A5%91%E6%9C%BA%E6%9D%A5%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%B7%B1%E7%9A%84Credential.%0A%0A%0A%23%23%23%202.%20%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%9E%E7%8E%B0Credential%0A%23%23%23%23%2001.%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84Credential%EF%BC%8C%E7%BB%A7%E6%89%BFRememberMeUsernamePasswordCredential%0A%2B%20!%5Bee633118fe124de2f0074a128bb074c0.png%5D(en-resource%3A%2F%2Fdatabase%2F3221%3A0)%0A%0A%23%23%23%23%2002.%20%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE%E7%9A%84WebflowConfigurer%EF%BC%8C%E7%BB%A7%E6%89%BFDefaultLoginWebflowConfigurer%0A%23%23%23%23%23%2002-1.%E7%9B%AE%E7%9A%84%0A1.%20%E8%BF%99%E6%A0%B7%E5%81%9A%E7%9A%84%E7%9B%AE%E7%9A%84%E5%B0%B1%E6%98%AF%E8%83%BD%E5%A4%9F%E5%9C%A8%E9%85%8D%E7%BD%AE%E4%BA%86Remember%20Me%E4%B9%8B%E5%90%8E%EF%BC%8C%E8%83%BD%E5%A4%9F%E4%BD%BF%E7%94%A8%E6%88%91%E4%BB%AC%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84Credential%E3%80%82%0A%0A%23%23%23%23%23%2002-2.%E9%87%8D%E5%86%99%E6%96%B9%E6%B3%95%EF%BC%88createRememberMeAuthnWebflowConfig%EF%BC%89%0A%2B%20!%5B3b7cf73455201e17ff6bc08da37eef74.png%5D(en-resource%3A%2F%2Fdatabase%2F3223%3A0)%0A%0A%23%23%23%23%23%2002-3.%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AEWebflowConfigurer%0A%2B%20!%5Be951ef870ac4690269027068f67063e3.png%5D(en-resource%3A%2F%2Fdatabase%2F3225%3A0)%0A%2B%20%E6%B3%A8%E6%84%8F%EF%BC%8C%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%E5%9C%A8cn.bosswang.Weisaas.config.CasAuthenticationConfiguration%E4%B8%AD%E5%86%99%E7%9A%84%EF%BC%8C%E8%BF%99%E4%B8%AA%E7%B1%BB%E5%9C%A8%E6%96%87%E4%BB%B6spring.factories%E4%B8%AD%E5%B7%B2%E7%BB%8F%E9%85%8D%E7%BD%AE%EF%BC%8C%E4%BC%9A%E4%BD%9C%E4%B8%BA%E4%B8%80%E4%B8%AA%E5%90%AF%E5%8A%A8%E9%85%8D%E7%BD%AE%E8%A2%AB%E5%8A%A0%E8%BD%BD%E3%80%82%0A%0A%23%23%23%203.%20%E5%A6%82%E4%BD%95%E5%B0%86%E5%B1%9E%E6%80%A7%E6%98%A0%E5%B0%84%E5%88%B0Credential%E4%B8%AD%E7%9A%84%E5%AD%97%E6%AE%B5%E4%B8%8A%0A%2B%20%E6%97%A2%E7%84%B6%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BA%86Credential%EF%BC%8C%E8%82%AF%E5%AE%9A%E4%BC%9A%E6%96%B0%E5%A2%9E%E4%B8%80%E4%BA%9B%E5%AD%97%E6%AE%B5%EF%BC%8C%E9%82%A3%E4%B9%88%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2%E4%B8%AD%E7%9A%84%E8%A1%A8%E5%8D%95%E4%B8%8A%E7%9A%84%E5%AD%97%E6%AE%B5%E5%A6%82%E4%BD%95%E6%98%A0%E5%B0%84%E5%88%B0%E5%AF%B9%E5%BA%94%E7%9A%84Credential%E7%9A%84%E5%AD%97%E6%AE%B5%E4%B8%8A%E5%91%A2%EF%BC%9F%0A%20%20%20%20-%20%E6%96%87%E4%BB%B6%EF%BC%9AcasLoginView.html%EF%BC%88%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2%EF%BC%89%0A%20%20%20%20-%20%E5%A6%82%E4%BD%95%E5%AF%B9%E5%BA%94%EF%BC%9A!%5Becb525e33bd6167917c9edbd0e43e0ea.png%5D(en-resource%3A%2F%2Fdatabase%2F3227%3A0)%0A%0A%20%20%20%20%0A%0A%0A</center></body></html>