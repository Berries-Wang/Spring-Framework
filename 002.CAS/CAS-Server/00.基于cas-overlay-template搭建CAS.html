<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 9.7.4 (472469)"/><meta name="author" content="1849553578@qq.com"/><meta name="created" content="2020-06-18 03:44:35 +0000"/><meta name="source" content="desktop.win"/><meta name="source-application" content="yinxiang.win32"/><meta name="source-url" content="https://blog.csdn.net/qq_34021712/article/details/80871015"/><meta name="updated" content="2020-06-25 16:15:15 +0000"/><meta name="content-class" content="yinxiang.markdown"/><title>00.基于cas-overlay-template搭建CAS</title></head><body><div style="font-size: 14px; margin: 0; padding: 0; width: 100%;"><h1 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 41px; border-bottom: 3px double #999; color: #000; margin-top: 14px;">基于Cas-Overlay-Template搭建CAS</h1>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">Cas-Overlay-Template版本信息</h2>
<ol style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;">
<li style="line-height: 160%; box-sizing: content-box;">版本 Cas5.3.14</li>
</ol>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">1.什么是overlay</h2>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">&nbsp;&nbsp;&nbsp;&nbsp;overlay可以把多个项目war合并成为一个项目，并且如果项目存在同名文件，那么主项目中的文件将覆盖掉其他项目的同名文件。使用maven 的Overlay配置实现无侵入的改造cas。</p>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">2.CAS认证流程</h2>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">流程图</h2>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><img src="00.%E5%9F%BA%E4%BA%8Ecas-overlay-template%E6%90%AD%E5%BB%BACAS.resources/67B08F74-6E37-4EB8-92FC-D8FB2A1D3757.png" height="624" width="595"/></li>
</ul>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">注意事项</h2>
<ol style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;">
<li style="line-height: 160%; box-sizing: content-box;">如上图（第一个判断），在cas的认证过程中逐个执行authenticationHandlers中配置的认证管理，直到有一个成功为止，成功了就返回，执行下一步操作。
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333; margin-top: 0; margin-bottom: 0;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">org.apereo.cas.authentication.PolicyBasedAuthenticationManager</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><img src="00.%E5%9F%BA%E4%BA%8Ecas-overlay-template%E6%90%AD%E5%BB%BACAS.resources/66760138-5DE6-444D-8139-CA1B4AFB948A.png" height="1058" width="1928"/></li>
</ul>
</li>
</ol>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">3. 创建项目</h2>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="00.%E5%9F%BA%E4%BA%8Ecas-overlay-template%E6%90%AD%E5%BB%BACAS.resources/72D14E3D-2929-400D-BA49-D4F3A41E2AAD.png" height="1058" width="1920"/></p>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">4. Web Flow</h2>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">什么是Web Flow？
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333; margin-top: 0; margin-bottom: 0;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">关键在于Flow，Flow 可看作是客户端与服务器的一次对话（ conversation ）。 Flow 的完成要由分多个步骤来实现，在 Spring Web Flow 的语义中，步骤指的就是 state 。 Spring Web Flow 提供了五种 state ，分别是 Action State 、 View State 、 Subflow State 、 Decision State 、 End State ，这些 state 可用于定义 flow 执行过程中的各个步骤。除了 End State 外，其他 state 都可以转换到别的 state ，一般通过在 state 中定义 transition 来实现到其他 state 的转换，转换的发生一般由事件（ event ）来触发。</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">即：分步骤实现</li>
</ul>
</li>
</ul>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">5. <a href="https://apereo.github.io/cas/5.2.x/protocol/CAS-Protocol.html" style="line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;">CAS数据流转图(整个登录流程)</a></h2>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">The&nbsp;&nbsp;TGT&nbsp;&nbsp;(Ticket Granting Ticket), stored in the&nbsp;&nbsp;TGC&nbsp;&nbsp;cookie, represents a SSO session for a user.</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">The&nbsp;&nbsp;ST&nbsp;&nbsp;(Service Ticket), transmitted as a&nbsp;&nbsp;GET&nbsp;&nbsp;parameter in urls, stands for the access granted by the CAS server to the&nbsp;&nbsp;CASified&nbsp;&nbsp;application for a specific user.</li>
</ul>
<ol style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;">
<li style="line-height: 160%; box-sizing: content-box;">Web flow diagram(没有代理)
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333; margin-top: 0; margin-bottom: 0;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><img src="00.%E5%9F%BA%E4%BA%8Ecas-overlay-template%E6%90%AD%E5%BB%BACAS.resources/76E5BB2F-51A8-4DA8-A2BD-C88FFF98E369.png" height="2020" width="1230"/></li>
</ul>
</li>
<li style="line-height: 160%; box-sizing: content-box;">Proxy web flow diagram
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333; margin-top: 0; margin-bottom: 0;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><img src="00.%E5%9F%BA%E4%BA%8Ecas-overlay-template%E6%90%AD%E5%BB%BACAS.resources/cas_proxy_flow_diagram.jpg" height="1708" width="1131"/></li>
</ul>
</li>
</ol>
</div><center style="display:none !important;visibility:collapse !important;height:0 !important;white-space:nowrap;width:100%;overflow:hidden">%23%20%E5%9F%BA%E4%BA%8ECas-Overlay-Template%E6%90%AD%E5%BB%BACAS%0A%23%23%20Cas-Overlay-Template%E7%89%88%E6%9C%AC%E4%BF%A1%E6%81%AF%0A1.%20%E7%89%88%E6%9C%AC%20Cas5.3.14%0A%23%23%201.%E4%BB%80%E4%B9%88%E6%98%AFoverlay%0A%26nbsp%3B%26nbsp%3Boverlay%E5%8F%AF%E4%BB%A5%E6%8A%8A%E5%A4%9A%E4%B8%AA%E9%A1%B9%E7%9B%AEwar%E5%90%88%E5%B9%B6%E6%88%90%E4%B8%BA%E4%B8%80%E4%B8%AA%E9%A1%B9%E7%9B%AE%EF%BC%8C%E5%B9%B6%E4%B8%94%E5%A6%82%E6%9E%9C%E9%A1%B9%E7%9B%AE%E5%AD%98%E5%9C%A8%E5%90%8C%E5%90%8D%E6%96%87%E4%BB%B6%EF%BC%8C%E9%82%A3%E4%B9%88%E4%B8%BB%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E6%96%87%E4%BB%B6%E5%B0%86%E8%A6%86%E7%9B%96%E6%8E%89%E5%85%B6%E4%BB%96%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%90%8C%E5%90%8D%E6%96%87%E4%BB%B6%E3%80%82%E4%BD%BF%E7%94%A8maven%20%E7%9A%84Overlay%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0%E6%97%A0%E4%BE%B5%E5%85%A5%E7%9A%84%E6%94%B9%E9%80%A0cas%E3%80%82%0A%23%23%202.CAS%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B%0A%23%23%20%E6%B5%81%E7%A8%8B%E5%9B%BE%0A%2B%20!%5Be1bcf068458908f48af29d21ded874b4.png%5D(en-resource%3A%2F%2Fdatabase%2F929%3A1)%0A%0A%23%23%20%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%0A1.%20%E5%A6%82%E4%B8%8A%E5%9B%BE%EF%BC%88%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%88%A4%E6%96%AD%EF%BC%89%EF%BC%8C%E5%9C%A8cas%E7%9A%84%E8%AE%A4%E8%AF%81%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%80%90%E4%B8%AA%E6%89%A7%E8%A1%8CauthenticationHandlers%E4%B8%AD%E9%85%8D%E7%BD%AE%E7%9A%84%E8%AE%A4%E8%AF%81%E7%AE%A1%E7%90%86%EF%BC%8C%E7%9B%B4%E5%88%B0%E6%9C%89%E4%B8%80%E4%B8%AA%E6%88%90%E5%8A%9F%E4%B8%BA%E6%AD%A2%EF%BC%8C%E6%88%90%E5%8A%9F%E4%BA%86%E5%B0%B1%E8%BF%94%E5%9B%9E%EF%BC%8C%E6%89%A7%E8%A1%8C%E4%B8%8B%E4%B8%80%E6%AD%A5%E6%93%8D%E4%BD%9C%E3%80%82%0A%20%20%20%20-%20org.apereo.cas.authentication.PolicyBasedAuthenticationManager%0A%20%20%20%20-%20!%5Beef48b9ef124da60e89d8f7e135bb524.png%5D(en-resource%3A%2F%2Fdatabase%2F930%3A1)%0A%20%20%20%20%0A%23%23%203.%20%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE%0A!%5Baa0ea594a0e7e369a31d55ff2e74e7da.png%5D(en-resource%3A%2F%2Fdatabase%2F931%3A1)%0A%0A%23%23%204.%20Web%20Flow%0A%2B%20%E4%BB%80%E4%B9%88%E6%98%AFWeb%20Flow%EF%BC%9F%0A%20%20%20-%20%E5%85%B3%E9%94%AE%E5%9C%A8%E4%BA%8EFlow%EF%BC%8CFlow%20%E5%8F%AF%E7%9C%8B%E4%BD%9C%E6%98%AF%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E4%B8%80%E6%AC%A1%E5%AF%B9%E8%AF%9D%EF%BC%88%20conversation%20%EF%BC%89%E3%80%82%20Flow%20%E7%9A%84%E5%AE%8C%E6%88%90%E8%A6%81%E7%94%B1%E5%88%86%E5%A4%9A%E4%B8%AA%E6%AD%A5%E9%AA%A4%E6%9D%A5%E5%AE%9E%E7%8E%B0%EF%BC%8C%E5%9C%A8%20Spring%20Web%20Flow%20%E7%9A%84%E8%AF%AD%E4%B9%89%E4%B8%AD%EF%BC%8C%E6%AD%A5%E9%AA%A4%E6%8C%87%E7%9A%84%E5%B0%B1%E6%98%AF%20state%20%E3%80%82%20Spring%20Web%20Flow%20%E6%8F%90%E4%BE%9B%E4%BA%86%E4%BA%94%E7%A7%8D%20state%20%EF%BC%8C%E5%88%86%E5%88%AB%E6%98%AF%20Action%20State%20%E3%80%81%20View%20State%20%E3%80%81%20Subflow%20State%20%E3%80%81%20Decision%20State%20%E3%80%81%20End%20State%20%EF%BC%8C%E8%BF%99%E4%BA%9B%20state%20%E5%8F%AF%E7%94%A8%E4%BA%8E%E5%AE%9A%E4%B9%89%20flow%20%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B%E4%B8%AD%E7%9A%84%E5%90%84%E4%B8%AA%E6%AD%A5%E9%AA%A4%E3%80%82%E9%99%A4%E4%BA%86%20End%20State%20%E5%A4%96%EF%BC%8C%E5%85%B6%E4%BB%96%20state%20%E9%83%BD%E5%8F%AF%E4%BB%A5%E8%BD%AC%E6%8D%A2%E5%88%B0%E5%88%AB%E7%9A%84%20state%20%EF%BC%8C%E4%B8%80%E8%88%AC%E9%80%9A%E8%BF%87%E5%9C%A8%20state%20%E4%B8%AD%E5%AE%9A%E4%B9%89%20transition%20%E6%9D%A5%E5%AE%9E%E7%8E%B0%E5%88%B0%E5%85%B6%E4%BB%96%20state%20%E7%9A%84%E8%BD%AC%E6%8D%A2%EF%BC%8C%E8%BD%AC%E6%8D%A2%E7%9A%84%E5%8F%91%E7%94%9F%E4%B8%80%E8%88%AC%E7%94%B1%E4%BA%8B%E4%BB%B6%EF%BC%88%20event%20%EF%BC%89%E6%9D%A5%E8%A7%A6%E5%8F%91%E3%80%82%0A%20%20%20-%20%E5%8D%B3%EF%BC%9A%E5%88%86%E6%AD%A5%E9%AA%A4%E5%AE%9E%E7%8E%B0%0A%0A%23%23%205.%20%5BCAS%E6%95%B0%E6%8D%AE%E6%B5%81%E8%BD%AC%E5%9B%BE(%E6%95%B4%E4%B8%AA%E7%99%BB%E5%BD%95%E6%B5%81%E7%A8%8B)%5D(https%3A%2F%2Fapereo.github.io%2Fcas%2F5.2.x%2Fprotocol%2FCAS-Protocol.html)%0A%0A%2B%20The%C2%A0TGT%C2%A0(Ticket%20Granting%20Ticket)%2C%20stored%20in%20the%C2%A0TGC%C2%A0cookie%2C%20represents%20a%20SSO%20session%20for%20a%20user.%0A%2B%20The%C2%A0ST%C2%A0(Service%20Ticket)%2C%20transmitted%20as%20a%C2%A0GET%C2%A0parameter%20in%20urls%2C%20stands%20for%20the%20access%20granted%20by%20the%20CAS%20server%20to%20the%C2%A0CASified%C2%A0application%20for%20a%20specific%20user.%0A%0A1.%20Web%20flow%20diagram(%E6%B2%A1%E6%9C%89%E4%BB%A3%E7%90%86)%0A%20%20%20%20-%20!%5B97be6ba59432de0000f7fd043bcb7183.png%5D(en-resource%3A%2F%2Fdatabase%2F1010%3A0)%0A2.%20Proxy%20web%20flow%20diagram%0A%20%20%20%20-%20!%5B60f80dcbb33a19ca1964ff2c2581db1b.jpeg%5D(en-resource%3A%2F%2Fdatabase%2F1014%3A0)%0A%20%20%20%20%0A%20%20%20%20</center></body></html>